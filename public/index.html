<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¿ CBD Stock Manager</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ğŸŒ¿ CBD Stock Manager</h1>

      <!-- Badge statut -->
      <span class="status-badge" id="statusBadge">
        <span class="loading"></span> Chargement...
      </span>

      <!-- Infos serveur (remplies par app.js) -->
      <div class="server-meta" style="margin-top:10px; color:#718096; font-weight:600;">
        Mode: <span id="serverMode">-</span>
      </div>
      <!-- Le JS injecte ici le bloc tri/filtre/import -->
      <!-- (catalogControls sera auto-ajoutÃ© dans .header) -->
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Produits actifs</h3>
        <div class="value" id="statProducts">-</div>
        <div class="label">Configurations actives</div>
      </div>
      <div class="stat-card">
        <h3>Stock total</h3>
        <div class="value" id="statGrams">-</div>
        <div class="label">Grammes disponibles</div>
      </div>
      <div class="stat-card">
        <h3>Webhook</h3>
        <div class="value" id="webhookStatus">-</div>
        <div class="label" id="webhookLabel">VÃ©rification...</div>
      </div>
      <div class="stat-card">
        <h3>SÃ©curitÃ© HMAC</h3>
        <div class="value" id="hmacStatus">-</div>
        <div class="label" id="hmacLabel">VÃ©rification...</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Products List -->
      <div class="card">
        <h2 class="card-title">ğŸ“¦ Gestion du Stock</h2>
        <div class="info-box">
          <strong>ğŸ“Š Surveillance en temps rÃ©el</strong><br>
          Les stocks sont mis Ã  jour automatiquement lors de chaque commande Shopify.
        </div>
        <div class="product-list" id="productList">
          <div style="text-align: center; padding: 40px; color: #a0aec0;">
            â³ Chargement des produits...
          </div>
        </div>
      </div>

      <!-- Actions Panel -->
      <div class="card">
        <h2 class="card-title">âš¡ Actions Rapides</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="testOrder()">
            ğŸ§ª Tester une commande
          </button>
          <button class="btn btn-success" onclick="openRestockModal()">
            â™»ï¸ RÃ©approvisionner
          </button>
          <button class="btn btn-info" onclick="refreshStock()">
            ğŸ”„ Actualiser le stock
          </button>
        </div>

        <div class="info-box" style="margin-top: 20px;">
          <strong>ğŸ’¡ Astuce</strong><br>
          Utilisez le bouton "Tester" pour simuler une commande et vÃ©rifier le fonctionnement.
        </div>
      </div>
    </div>

    <!-- Result Panel -->
    <div class="result-panel">
      <h2 class="card-title">ğŸ“‹ Console de rÃ©sultats</h2>
      <div class="result-content" id="result">
Bienvenue dans le gestionnaire de stock CBD ! ğŸŒ¿

âœ¨ FonctionnalitÃ©s disponibles :
  â€¢ Surveillance automatique des commandes Shopify
  â€¢ Mise Ã  jour en temps rÃ©el du stock
  â€¢ RÃ©approvisionnement manuel
  â€¢ Tests de commandes simulÃ©es
  â€¢ Import produits Shopify (auto variantes)
  â€¢ CatÃ©gories + tri Aâ†’Z
  â€¢ Export CSV (stock + mouvements)

ğŸ‘† Cliquez sur un bouton pour commencer...
      </div>
    </div>

    <!-- (optionnel) DerniÃ¨re MAJ (si ton JS veut lâ€™afficher) -->
    <div style="display:none" id="lastUpdate">-</div>
  </div>

  <!-- Restock Modal -->
  <div class="modal" id="restockModal">
    <div class="modal-content">
      <h3 class="modal-title">â™»ï¸ RÃ©approvisionner un produit</h3>
      <form id="restockForm" onsubmit="submitRestock(event)">
        <div class="form-group">
          <label for="productSelect">Produit</label>
          <select id="productSelect" required>
            <option value="">SÃ©lectionnez un produit...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="gramsInput">QuantitÃ© Ã  ajouter (grammes)</label>
          <input type="number" id="gramsInput" min="1" required placeholder="Ex: 50">
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn btn-secondary" onclick="closeRestockModal()">
            Annuler
          </button>
          <button type="submit" class="btn btn-success">
            âœ… Confirmer
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Product Detail Modal -->
  <div class="modal" id="productModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 class="modal-title" id="productModalTitle">DÃ©tails du produit</h3>
        <button type="button" class="btn-close" onclick="closeProductModal()">âœ•</button>
      </div>

      <div class="product-detail-grid">
        <!-- Stock Total -->
        <div class="detail-section">
          <h4>ğŸ“Š Stock Total</h4>
          <div class="stock-total-edit">
            <input type="number" id="totalGramsInput" class="large-input" min="0" step="0.1">
            <span class="unit-label">grammes</span>
          </div>
          <button class="btn btn-primary btn-small" onclick="updateTotalStock()">
            ğŸ’¾ Mettre Ã  jour le stock total
          </button>
        </div>

        <!-- Variantes -->
        <div class="detail-section">
          <h4>ğŸ“¦ Variantes disponibles</h4>
          <div id="variantsList" class="variants-list"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">
          Fermer
        </button>
      </div>
    </div>
  </div>

  <script src="/js/app.js"></script>
</body>
</html>
