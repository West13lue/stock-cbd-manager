# ğŸš€ Stock CBD Manager PRO

## Application professionnelle de gestion de stock pour Shopify

---

## ğŸ“¦ Modules inclus

| Module | Fichier | Description |
|--------|---------|-------------|
| **Plans** | `planManager.js` | Free/Starter/Pro/Business/Enterprise |
| **ParamÃ¨tres** | `settingsManager.js` | Configuration complÃ¨te internationale |
| **Lots & DLC** | `batchStore.js` | TraÃ§abilitÃ©, pÃ©remption, FIFO |
| **Fournisseurs** | `supplierStore.js` | Carnet d'adresses, prix |
| **Bons de commande** | `purchaseOrderStore.js` | Workflow PO complet |
| **PrÃ©visions** | `forecastManager.js` | PrÃ©diction ruptures, vÃ©locitÃ© |
| **Kits/Bundles** | `kitStore.js` | Produits composÃ©s |
| **Inventaire** | `inventoryCountStore.js` | Comptage physique, Ã©carts |
| **Analytics** | `analyticsManager.js` | CA, marges, tendances |

---

## ğŸ’° Plans & Tarification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAN        â”‚ PRIX    â”‚ PRODUITS â”‚ FONCTIONNALITÃ‰S                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Free        â”‚ 0â‚¬      â”‚ 2        â”‚ Stock, CMP, Export basique          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Starter     â”‚ 14,99â‚¬  â”‚ 15       â”‚ + CatÃ©gories, Import, Valeur stock  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pro         â”‚ 39,99â‚¬  â”‚ 75       â”‚ + Lots/DLC, Fournisseurs,           â”‚
â”‚             â”‚         â”‚          â”‚   Inventaire, Analytics,            â”‚
â”‚             â”‚         â”‚          â”‚   Notifications                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Business    â”‚ 79,99â‚¬  â”‚ IllimitÃ© â”‚ + PrÃ©visions IA, Kits/Bundles,      â”‚
â”‚             â”‚         â”‚          â”‚   Bons de commande, Multi-users,    â”‚
â”‚             â”‚         â”‚          â”‚   Automatisations, IntÃ©grations,    â”‚
â”‚             â”‚         â”‚          â”‚   Rapports email, Support prio      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Enterprise  â”‚ 199â‚¬+   â”‚ IllimitÃ© â”‚ + Multi-boutiques, API, SLA,        â”‚
â”‚             â”‚         â”‚          â”‚   Account manager, Users illimitÃ©s  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Gestion des Lots (Pro+)

### FonctionnalitÃ©s
- NumÃ©ro de lot unique auto-gÃ©nÃ©rÃ©
- Date de pÃ©remption (DLC/DLUO)
- TraÃ§abilitÃ© fournisseur
- DÃ©stockage FIFO automatique
- Alertes lots expirants

### Exemple d'utilisation
```javascript
const batchStore = require('./batchStore');

// CrÃ©er un lot
const batch = batchStore.createBatch(shop, productId, {
  grams: 500,
  purchasePricePerGram: 4.50,
  expiryType: 'dlc',
  expiryDate: '2025-07-15',
  supplierId: 'sup_123',
});

// DÃ©stocker en FIFO
const result = batchStore.deductGramsFIFO(shop, productId, 100);
// â†’ Utilise automatiquement les lots les plus anciens/proches pÃ©remption

// Alertes pÃ©remption
const expiring = batchStore.getExpiringBatches(shop, { daysThreshold: 30 });
```

---

## ğŸ­ Gestion Fournisseurs (Pro+)

### FonctionnalitÃ©s
- Carnet d'adresses complet
- Conditions commerciales (dÃ©lais, minimum, franco)
- Prix par produit
- Comparaison entre fournisseurs

### Exemple
```javascript
const supplierStore = require('./supplierStore');

// CrÃ©er un fournisseur
const supplier = supplierStore.createSupplier(shop, {
  name: 'CBD Wholesale France',
  code: 'CBDWF',
  contact: { email: 'contact@cbdwf.fr', phone: '+33123456789' },
  terms: { deliveryDays: 3, minOrderAmount: 500 },
});

// Ajouter prix pour un produit
supplierStore.setProductPrice(shop, supplier.id, productId, 4.50);

// Comparer les prix
const comparison = supplierStore.comparePrices(shop, productId, 1000);
// â†’ Liste triÃ©e par prix avec Ã©conomies
```

---

## ğŸ“ Bons de Commande (Business+)

### Workflow
```
Brouillon â†’ EnvoyÃ© â†’ ConfirmÃ© â†’ ReÃ§u partiellement â†’ Complet
                                      â†“
                              CrÃ©ation lots auto
```

### Exemple
```javascript
const poStore = require('./purchaseOrderStore');

// CrÃ©er un PO
const po = poStore.createPurchaseOrder(shop, {
  supplierId: 'sup_123',
  supplierName: 'CBD Wholesale',
  lines: [
    { productId: 'prod_1', productName: 'CBD Premium', grams: 500, pricePerGram: 4.50 },
    { productId: 'prod_2', productName: 'CBD Relax', grams: 300, pricePerGram: 5.00 },
  ],
  shippingCost: 15,
});

// Envoyer au fournisseur
poStore.sendPurchaseOrder(shop, po.id);

// RÃ©ceptionner (crÃ©e les lots automatiquement)
const result = poStore.receiveItems(shop, po.id, [
  { lineId: 'line_1', receivedGrams: 500, expiryDate: '2025-06-15' },
  { lineId: 'line_2', receivedGrams: 300, expiryDate: '2025-06-15' },
]);
```

---

## ğŸ”® PrÃ©visions de Rupture (Business+)

### Algorithme
1. Calcul vÃ©locitÃ© pondÃ©rÃ©e (jours rÃ©cents comptent plus)
2. Analyse saisonnalitÃ© (jours de la semaine)
3. PrÃ©diction date de rupture
4. Suggestion quantitÃ© Ã  commander

### Exemple
```javascript
const forecast = require('./forecastManager');

// PrÃ©dire la rupture
const prediction = forecast.predictStockout(shop, productId, currentStock);
// â†’ { daysUntilStockout: 12, urgency: 'medium', message: 'ğŸŸ¡ Commander cette semaine' }

// Suggestion de commande
const suggestion = forecast.suggestReorderQuantity(shop, productId, currentStock, {
  targetStockDays: 30,
  safetyStockDays: 7,
});
// â†’ { suggestedQuantity: 500, coverageDays: 45 }

// Alertes globales
const alerts = forecast.getRestockAlerts(shop, stockSnapshot);
// â†’ Liste triÃ©e par urgence avec quantitÃ©s suggÃ©rÃ©es
```

---

## ğŸ§© Kits & Bundles (Business+)

### FonctionnalitÃ©s
- Recettes (composition du kit)
- Stock calculÃ© automatiquement (min des composants)
- CoÃ»t = somme des CMP
- DÃ©stockage auto des composants

### Exemple
```javascript
const kitStore = require('./kitStore');

// CrÃ©er un kit
const kit = kitStore.createKit(shop, {
  name: 'Pack DÃ©couverte',
  sku: 'PACK-DECOUVERTE',
  components: [
    { productId: 'prod_1', productName: 'CBD Premium', grams: 10 },
    { productId: 'prod_2', productName: 'CBD Relax', grams: 10 },
    { productId: 'prod_3', productName: 'CBD Sport', grams: 5 },
  ],
  sellingPrice: 75,
});

// Calculer le stock disponible
const stock = kitStore.calculateKitStock(shop, kit.id, stockSnapshot);
// â†’ { stock: 15, limitingFactor: { productId: 'prod_3', kitsPossible: 15 } }

// Calculer coÃ»t et marge
const costs = kitStore.calculateKitCost(shop, kit.id, stockSnapshot);
// â†’ { totalCost: 52.50, margin: 22.50, marginPercent: 30 }
```

---

## ğŸ“‹ Inventaire Physique (Pro+)

### Workflow
```
CrÃ©ation â†’ Saisie comptage â†’ Validation â†’ Ajustements appliquÃ©s
```

### Exemple
```javascript
const invStore = require('./inventoryCountStore');

// CrÃ©er un inventaire
const count = invStore.createInventoryCount(shop, stockSnapshot, {
  name: 'Inventaire Q1 2025',
  scope: 'full',
});

// Saisir les comptages
invStore.updateProductCount(shop, count.id, 'prod_1', 485, {
  notes: 'LÃ©gÃ¨re perte conditionnement',
});

// Soumettre pour validation
invStore.submitForReview(shop, count.id);

// Approuver et appliquer les ajustements
const result = invStore.approveAndAdjust(shop, count.id, 'user_123', stockManager);
// â†’ { adjustments: [...], summary: { totalVariance: -15, totalValueImpact: -67.50 } }

// Rapport d'Ã©carts
const report = invStore.generateVarianceReport(shop, count.id);
```

---

## âš™ï¸ ParamÃ¨tres (Tous plans)

### CatÃ©gories de paramÃ¨tres
- **GÃ©nÃ©ral** : Langue, timezone, formats date/heure
- **UnitÃ©s** : g/kg/oz/lb, prÃ©cision, arrondi
- **Monnaie** : EUR/USD/GBP, sÃ©parateurs
- **Stock** : Seuil bas, CMP figÃ©, source de vÃ©ritÃ©
- **Locations** : Location par dÃ©faut, multi-locations
- **Exports** : DÃ©limiteur CSV, encodage, colonnes
- **SÃ©curitÃ©** : Mode lecture seule, PIN, confirmations
- **Notifications** : Slack, Discord, dÃ©clencheurs

---

## ğŸ”Œ API Endpoints

### Plans
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/plan` | Info plan actuel |
| POST | `/api/plan/upgrade` | Changer de plan |
| POST | `/api/plan/trial` | DÃ©marrer essai |

### Lots (Pro+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/batches/:productId` | Liste lots d'un produit |
| POST | `/api/batches/:productId` | CrÃ©er un lot |
| GET | `/api/batches/expiring` | Lots expirants |

### Fournisseurs (Pro+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/suppliers` | Liste fournisseurs |
| POST | `/api/suppliers` | CrÃ©er fournisseur |
| GET | `/api/suppliers/:id/products` | Prix par produit |

### Bons de commande (Business+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/purchase-orders` | Liste PO |
| POST | `/api/purchase-orders` | CrÃ©er PO |
| POST | `/api/purchase-orders/:id/send` | Envoyer |
| POST | `/api/purchase-orders/:id/receive` | RÃ©ceptionner |

### PrÃ©visions (Business+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/forecast/:productId` | PrÃ©vision produit |
| GET | `/api/forecast/alerts` | Alertes rÃ©appro |
| GET | `/api/forecast/report` | Rapport complet |

### Kits (Business+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/kits` | Liste kits |
| POST | `/api/kits` | CrÃ©er kit |
| GET | `/api/kits/:id/stock` | Stock calculÃ© |

### Inventaire (Pro+)
| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/api/inventory-counts` | Liste inventaires |
| POST | `/api/inventory-counts` | CrÃ©er inventaire |
| POST | `/api/inventory-counts/:id/approve` | Approuver |

---

## ğŸ“ Structure des fichiers

```
stock-cbd-manager/
â”œâ”€â”€ server.js                 # Serveur principal + routes
â”œâ”€â”€ planManager.js            # Gestion des plans
â”œâ”€â”€ settingsManager.js        # ParamÃ¨tres avancÃ©s
â”œâ”€â”€ stockManager.js           # Gestion stock (existant)
â”œâ”€â”€ analyticsStore.js         # Persistance analytics
â”œâ”€â”€ analyticsManager.js       # Calculs analytics
â”œâ”€â”€ batchStore.js             # Lots & DLC
â”œâ”€â”€ supplierStore.js          # Fournisseurs
â”œâ”€â”€ purchaseOrderStore.js     # Bons de commande
â”œâ”€â”€ forecastManager.js        # PrÃ©visions
â”œâ”€â”€ kitStore.js               # Kits/Bundles
â”œâ”€â”€ inventoryCountStore.js    # Inventaire physique
â”œâ”€â”€ catalogStore.js           # CatÃ©gories (existant)
â”œâ”€â”€ movementStore.js          # Mouvements (existant)
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ css/style.css
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js
â”‚       â”œâ”€â”€ analytics.js
â”‚       â””â”€â”€ settings.js
â””â”€â”€ README-PRO.md
```

---

## ğŸš€ Installation

```bash
# 1. Extraire l'archive
unzip stock-manager-pro-v2.zip

# 2. Copier les fichiers dans votre projet
cp *.js /votre-projet/
cp -r public/* /votre-projet/public/

# 3. Installer les dÃ©pendances (si nÃ©cessaire)
npm install

# 4. DÃ©marrer
npm start
```

---

## ğŸ”’ ConformitÃ© & SÃ©curitÃ©

### Collecte minimale (RGPD)
- âŒ Pas de nom client
- âŒ Pas d'email client
- âŒ Pas d'adresse
- âœ… Uniquement : orderId, productId, qty, prix, coÃ»t, marge

### TraÃ§abilitÃ© (CBD/Alimentaire)
- âœ… NumÃ©ros de lots
- âœ… Dates de pÃ©remption
- âœ… Lien fournisseur
- âœ… Historique complet

---

## ğŸ“ Support

- **Free** : Documentation uniquement
- **Starter/Pro** : Email sous 48h
- **Business** : Email sous 24h + Chat
- **Enterprise** : TÃ©lÃ©phone + Account manager

---

*Stock CBD Manager PRO v2.0 â€” Â© 2025*
